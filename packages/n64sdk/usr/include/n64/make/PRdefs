#
# Commondefs for BB player source tree
#
# Makefiles which include this should first define PRDEPTH or BBDEPTH
# to be the relative path from their parent directory.

include /usr/include/n64/make/commondefs

#
# Use $(MAKE) $(MAKEARGS) instead of $(MAKEF) so that make -n works
# This gets around the fact that $(MAKE) works and $(MAKEF) does not.
# MAKEARGS is based directly on $(MAKEF) in commondefs.
#
MAKEARGS = VCFLAGS="$(VCFLAGS)" VFFLAGS="$(VFFLAGS)" \
	VPFLAGS="$(VPFLAGS)" VMKDEPFLAGS="$(VMKDEPFLAGS)"

# make sure 'default' does not hit these rules
defaultrule: default

#
#  Compile tree for RCP 1.0 or RCP 2.0
#
#GCDEFS = $(HW_FLAGS)
#GCDEFS = $(HW_FLAGS) -B -Wab, -r4300_mul
__GCC__=1
ifdef __GCC__
# If somebody needs to define a custom compiler toolchain...
N64_CC ?= mips-linux-gnu-gcc -c -D_MIPS_SZLONG=32 -D_MIPS_SZINT=32 -D_LANGUAGE_C -D_ULTRA64 -D__EXTENSIONS__ -mabi=32 -march=vr4300 -mtune=vr4300 -mfix4300
N64_AS ?= mips-linux-gnu-as -march=r4300 -mabi=32
N64_LD ?= mips-linux-gnu-ld --no-check-sections
N64_SIZE ?= mips-linux-gnu-size

CC=$(N64_CC)
AS=$(N64_AS)
LD=$(N64_LD)
SIZE=$(N64_SIZE)

NAWK=awk
WOFF=
MKDEPOPT=
GCDEFS = -DBBPLAYER
#CVERSION=-ansi
CVERSION=
else
GCDEFS = $(HW_FLAGS) -Wab,-r4300_mul
endif

#
# VCS compiler options
#
VCSOPTS = $(GVCSOPTS) $(LVCSOPTS) $(VVCSOPTS)
#GVCSOPTS = +acc -V -M -Mupdate -Mmakep=pmake				   \
	   -CC "-mips2 -Wab,-big_got -Wab,-dwalign" -lgl -limage	   \
	   -P $(PRDEPTH)/rdpsim/pli/pli.tab $(ROOT)/usr/lib/PR/libpli.a
GVCSOPTS = +acc -V -M -Mupdate \
	   -P $(PRDEPTH)/rdpsim/pli/pli.tab $(ROOT)/usr/lib/PR/libpli.a

SHELL	= /bin/sh

FLT2C       = flt2c
IC          = ic
MAKEROM     = spicy --as_command=mips-linux-gnu-as --cpp_command=mips-linux-gnu-cpp --ld_command=mips-linux-gnu-ld --objcopy_command=mips-linux-gnu-objcopy
MIDIPARSE   = midiparse		
MIDICVT     = midicvt
MIDICOMP    = midicomp
SBC         = sbc
NLD         = nld
RGB2C       = rgb2c
MKSPRITE    = mksprite
MKISPRITE   = mkisprite
TABLEDESIGN = tabledesign
VADPCM_ENC  = vadpcm_enc
RSPASM      = rspasm
BUILDTASK   = buildtask
RSP2ELF     = rsp2elf

DATA2RDRAM = data2rdram
RDRAM2DATA = rdram2data
TMEMFMT    = tmemfmt

ECS2VL  = ecs2vl
ECSGEN  = ecs_gen
MERRG   = merrg
RMVCOM  = remove_comments
TAB2VMEM= tab2vmem
TAB2WVS = tab2wvs
VSIG    = vsig
XNET    = xnet

# ASYIN   = /ecad/ecs/ecs_2.4/bin/asyin
# MAKEINI = /ecad/ecs/ecs_2.4/bin/makeini

#VCSDIR  = /ecad/vcs/vcs_2.2/sgi
VCSDIR  = /ecad/vcs
VCS     = $(VCSDIR)/bin/vcs

LOG_RESULT = 								\
		@echo -n "!!! $(*:T) of" `basename \`pwd\``": ";	\
		grep "number of errors" $*.out

LOG_ERROR = $(LOG_RESULT)
HOST_CC += -DBBPLAYER
HOST_CCF = $(HOST_CC) -D_LANGUAGE_C
